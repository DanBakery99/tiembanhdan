import{i as p}from"./data-B5owOQz6.js";let n=localStorage.getItem("siteData")?JSON.parse(localStorage.getItem("siteData")):JSON.parse(JSON.stringify(p));const d=e=>new Promise((t,a)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=r=>{const c=new Image;c.src=r.target.result,c.onload=()=>{const l=document.createElement("canvas"),u=800,g=u/c.width;l.width=u,l.height=c.height*g,l.getContext("2d").drawImage(c,0,0,l.width,l.height),t(l.toDataURL("image/jpeg",.7))},c.onerror=l=>a(l)},o.onerror=r=>a(r)}),h=document.getElementById("login-modal"),y=document.getElementById("admin-dashboard"),v=document.getElementById("login-form"),b=document.getElementById("login-error");v.addEventListener("submit",e=>{e.preventDefault(),document.getElementById("password").value==="Toobakery0810"?(h.classList.add("hidden"),y.classList.remove("hidden"),w()):b.classList.remove("hidden")});document.getElementById("logout-btn").addEventListener("click",()=>{location.reload()});const m=document.querySelectorAll(".tab-btn"),f=document.querySelectorAll(".tab-content");m.forEach(e=>{e.addEventListener("click",()=>{m.forEach(t=>{t.classList.remove("bg-primary","text-white"),t.classList.add("text-gray-600","hover:bg-white","hover:text-primary")}),e.classList.remove("text-gray-600","hover:bg-white","hover:text-primary"),e.classList.add("bg-primary","text-white"),f.forEach(t=>t.classList.add("hidden")),document.getElementById(`tab-${e.dataset.tab}`).classList.remove("hidden")})});const w=()=>{i(),s(),I(),E()},i=()=>{const e=document.getElementById("menu-list");e.innerHTML="",n.menu.items.forEach((t,a)=>{const o=document.createElement("div");o.className="bg-gray-50 p-4 rounded-lg flex flex-col md:flex-row gap-4 items-start shadow-sm border border-gray-100",o.innerHTML=`
            <div class="w-full md:w-32 h-32 flex-shrink-0 bg-gray-200 rounded-lg overflow-hidden group relative">
                <img src="${t.image}" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center cursor-pointer" onclick="document.getElementById('menu-file-${a}').click()">
                    <span class="text-white text-xs text-center px-1">Đổi Ảnh</span>
                </div>
            </div>
            <div class="flex-1 space-y-3 w-full">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <input type="text" value="${t.name}" placeholder="Tên món" class="p-2 border rounded w-full text-sm font-bold" onchange="updateMenuItem(${a}, 'name', this.value)">
                    <input type="text" value="${t.price}" placeholder="Giá" class="p-2 border rounded w-full text-sm" onchange="updateMenuItem(${a}, 'price', this.value)">
                </div>
                <input type="text" value="${t.description}" placeholder="Mô tả" class="p-2 border rounded w-full text-sm" onchange="updateMenuItem(${a}, 'description', this.value)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 items-center">
                     <div class="flex gap-2 items-center">
                        <input type="text" value="${t.image}" placeholder="URL Hình ảnh" class="p-2 border rounded w-full text-sm text-gray-500 flex-1" onchange="updateMenuItem(${a}, 'image', this.value)">
                        <input type="file" id="menu-file-${a}" class="hidden" accept="image/*" onchange="uploadMenuImage(${a}, this)">
                        <button onclick="document.getElementById('menu-file-${a}').click()" class="bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded text-xs whitespace-nowrap">Upload</button>
                     </div>
                     <input type="text" value="${t.tag||""}" placeholder="Tag (e.g. Best Seller)" class="p-2 border rounded w-full text-sm" onchange="updateMenuItem(${a}, 'tag', this.value)">
                </div>
            </div>
            <button onclick="deleteMenuItem(${a})" class="text-red-500 hover:text-red-700 p-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </button>
        `,e.appendChild(o)})};window.updateMenuItem=(e,t,a)=>{n.menu.items[e][t]=a};window.uploadMenuImage=async(e,t)=>{if(t.files&&t.files[0])try{const a=await d(t.files[0]);n.menu.items[e].image=a,i()}catch(a){alert("Lỗi upload ảnh: "+a.message)}};window.deleteMenuItem=e=>{confirm("Bạn có chắc muốn xóa món này?")&&(n.menu.items.splice(e,1),i())};window.addMenuItem=()=>{n.menu.items.push({id:Date.now(),name:"Món Mới",description:"Mô tả món ăn...",price:"Liên hệ",image:"assets/img1.png",tag:"",tagColor:"primary"}),i()};const s=()=>{const e=document.getElementById("gallery-list");e.innerHTML="";const t=document.createElement("div");t.className="flex flex-col items-center justify-center bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg aspect-square cursor-pointer hover:bg-gray-200 transition-colors",t.onclick=()=>document.getElementById("gallery-upload-input").click(),t.innerHTML=`
        <svg class="w-10 h-10 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        <span class="text-sm text-gray-500 font-medium">Thêm Ảnh Mới</span>
        <input type="file" id="gallery-upload-input" class="hidden" accept="image/*" onchange="uploadGalleryImage(this)">
    `,e.appendChild(t),n.gallery.images.forEach((a,o)=>{const r=document.createElement("div");r.className="relative group aspect-square rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",r.innerHTML=`
            <img src="${a}" class="w-full h-full object-cover">
            <button onclick="deleteGalleryItem(${o})" class="absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <input type="text" value="${a}" class="absolute bottom-0 left-0 w-full p-1 text-xs bg-white/90 outline-none opacity-0 group-hover:opacity-100 transition-opacity" onchange="updateGalleryItem(${o}, this.value)">
        `,e.appendChild(r)})};window.uploadGalleryImage=async e=>{if(e.files&&e.files[0])try{const t=await d(e.files[0]);n.gallery.images.push(t),s()}catch(t){alert("Lỗi upload ảnh: "+t.message)}};window.deleteGalleryItem=e=>{confirm("Xóa ảnh này?")&&(n.gallery.images.splice(e,1),s())};window.updateGalleryItem=(e,t)=>{n.gallery.images[e]=t,s()};window.addGalleryItem=()=>{const e=prompt("Nhập URL hình ảnh (hoặc dùng nút Upload):");e&&(n.gallery.images.push(e),s())};const I=()=>{document.getElementById("about-title-input").value=n.about.title,document.getElementById("about-image-input").value=n.about.image,document.getElementById("about-content-input").value=n.about.paragraphs.join(`
`),document.getElementById("about-title-input").onchange=t=>n.about.title=t.target.value,document.getElementById("about-image-input").onchange=t=>n.about.image=t.target.value,document.getElementById("about-content-input").onchange=t=>n.about.paragraphs=t.target.value.split(`
`).filter(a=>a.trim()!=="");const e=document.getElementById("about-image-file");e&&(e.onchange=async t=>{if(t.target.files&&t.target.files[0])try{const a=await d(t.target.files[0]);n.about.image=a,document.getElementById("about-image-input").value=a,alert("Đã cập nhật ảnh thành công!")}catch(a){alert("Lỗi: "+a)}})},E=()=>{document.getElementById("contact-address-input").value=n.contact.address,document.getElementById("contact-phone-input").value=n.contact.phone,document.getElementById("contact-hours-input").value=n.contact.hours,document.getElementById("contact-map-input").value=n.contact.mapEmbed,document.getElementById("contact-address-input").onchange=e=>n.contact.address=e.target.value,document.getElementById("contact-phone-input").onchange=e=>n.contact.phone=e.target.value,document.getElementById("contact-hours-input").onchange=e=>n.contact.hours=e.target.value,document.getElementById("contact-map-input").onchange=e=>n.contact.mapEmbed=e.target.value};document.getElementById("save-btn").addEventListener("click",()=>{try{localStorage.setItem("siteData",JSON.stringify(n)),alert("Đã lưu thay đổi vào trình duyệt!")}catch(e){e.name==="QuotaExceededError"?alert("Lỗi: Dung lượng lưu trữ đã đầy! Hãy thử xóa bớt ảnh hoặc dùng ảnh nhỏ hơn."):alert("Lỗi khi lưu: "+e.message)}});document.getElementById("reset-btn").addEventListener("click",()=>{confirm("Bạn có chắc muốn reset về mặc định không? Mọi thay đổi chưa xuất file sẽ mất.")&&(localStorage.removeItem("siteData"),location.reload())});document.getElementById("export-btn").addEventListener("click",()=>{const e="export const initialData = "+JSON.stringify(n,null,4)+";",t=new Blob([e],{type:"text/javascript;charset=utf-8"}),a=URL.createObjectURL(t),o=document.createElement("a");o.href=a,o.download="data.js",document.body.appendChild(o),o.click(),document.body.removeChild(o)});
